<h1>Simulation d'une élection avec la methode de Condorcet</h1>
<p>Pour garder/partager les données de la simulation utilisez <a href="{{permanentLink}}">le lien permanent</a>.
<span>Notez que rafraichir la page annulera les dernières modifications.</span>
</p>
<h2>Les candidats de la simulation "<input style="font-size: 16pt" appElastischInput [(ngModel)]="simulation.elections.name" />"</h2>
 <p><button (click)="onAddCandidate()">Ajouter candidat</button></p>
    
        <div class="candidate" *ngFor="let candidate of simulation.elections.candidates;">
            <input [(ngModel)]="candidate.name" appElastischInput /><button class="delete" (click)="deleteCandidate(candidate)">x</button>
        </div>
    
   
<h2>Simuler des votes</h2>
<p>Avec un glisser/deposer vous pouvez trier par ordre de préférence les candidats de chaque groupe d'électeur.
    Un candidat décoché est desclassé.
</p>
<button (click)="onAddVote()">Ajouter groupe de vote</button>
<div>
    <div class="vote" *ngFor="let vote of simulation.votes;let index=index">
        <button class="delete" (click)="deleteVote(vote)">x</button>
        <h3>Electeurs - {{vote.name}} </h3>
        <div><label>nom : </label><input [(ngModel)]="vote.name" /></div>
        <div>nombre : <input [(ngModel)]="vote.quantity" (ngModelChange)="onChangeSort()" /></div>

        <div *ngFor="let rank of vote.ranking;let rankVal=index">
            <div  class='rank' dnd-sortable-container [sortableData]="rank.candidates" [dropZones]="[index]">
                 #{{rankVal+1}}
                <ul class="candidatevote">
                    <li *ngFor="let candidate of rank.candidates; let i = index"
                    dnd-sortable
                    [sortableIndex]="i"
                    (onDropSuccess)="onChangeSort()"
                    >
                        {{candidate.name}}
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<h2>Le Classement</h2>
<div>
    <ul>
        <li *ngFor="let result of simulation.results" >{{result.score}} <b>{{result.candidate.name}}</b>
            <span *ngFor="let looser of result.winAgainst;let last = last;let first = first">
                <span *ngIf="first">(</span> <u>{{looser.name}}</u> <span *ngIf="!last">, </span> <span *ngIf="last">)</span></span>
        </li>
    </ul>
</div>

<h2>Détails des duels</h2>
<div >
    <ul>
        <li *ngFor="let duel of simulation.duels" >
            <span [ngClass]="{'win': duel.ticWin, 'loose': duel.tacWin}">{{duel.tic.name}} - {{duel.ticScore}}</span> / 
            <span [ngClass]="{'win': duel.tacWin, 'loose': duel.ticWin}">{{duel.tacScore}} - {{duel.tac.name}}</span>
            
        </li>
    </ul>
</div>